# üêõ Bugfix: Card Positioning & Camera Clipping

## üî¥ –ü—Ä–æ–±–ª–µ–º—ã

1. **–ö–∞—Ä—Ç–æ—á–∫–∏ —Å–º–µ—â–µ–Ω—ã –≤–ø—Ä–∞–≤–æ**
   - –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—è–≤–ª—è–ª–∏—Å—å –ø—Ä–∞–≤–µ–µ —Ü–µ–Ω—Ç—Ä–∞ –∫–æ—Ä–∏–¥–æ—Ä–∞
   - –ü—Ä–∏—á–∏–Ω–∞: –ê–Ω–∏–º–∞—Ü–∏—è `roomEnter` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ `transform` –∏–∑ `builder.js`

2. **–ö–∞–º–µ—Ä–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å –∫–∞—Ä—Ç–æ—á–∫–∏**
   - –ü—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏—Å—å
   - –ü—Ä–∏—á–∏–Ω–∞: –ù–µ—Ç –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. `palace_engine/css/cards.css`

**–ë—ã–ª–æ:**
```css
@keyframes roomEnter {
  from {
    opacity: 0;
    transform: translateZ(-200px) scale(0.8); /* ‚ö†Ô∏è –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª transform! */
  }
  to {
    opacity: 1;
    /* transform –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω JS */
  }
}
```

**–°—Ç–∞–ª–æ:**
```css
@keyframes roomEnter {
  from {
    opacity: 0;
    filter: blur(10px); /* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º opacity + blur */
  }
  to {
    opacity: 1;
    filter: blur(0);
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `transform` –∏–∑ `builder.js` –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è.

---

### 2. `palace_engine/js/camera.js`

**–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥:**
```js
updateActiveRooms() {
  const rooms = document.querySelectorAll('.room');
  
  rooms.forEach(room => {
    const roomZ = parseFloat(room.dataset.position || 0);
    const distance = Math.abs(this.z - roomZ);
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É, –µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –±–ª–∏–∑–∫–æ
    if (distance < this.activeThreshold) {
      room.classList.add('room--active');
    } else {
      room.classList.remove('room--active');
    }
  });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –æ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–ª–∞—Å—Å `.room--active` —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ —Å–≤–µ—á–µ–Ω–∏—è.

---

## üöÄ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –û—Ç–∫—Ä–æ–π `palace_engine/index.html?lesson=263`
2. –ü—Ä–æ–∫—Ä—É—Ç–∏ –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏ –∏–ª–∏ –Ω–∞–∂–º–∏ `‚Üë` / `‚Üì`
3. –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã:
   - ‚úÖ –ë—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–æ—Ä–∏–¥–æ—Ä–∞
   - ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ (—Å–≤–µ—á–µ–Ω–∏–µ + —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)
   - ‚úÖ –ù–µ —Å–º–µ—â–∞—Ç—å—Å—è –ø—Ä–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è

---

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|------------|
| `activeThreshold` | 400px | –†–∞–¥–∏—É—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ |
| `roomSpacing` | 800px | –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ |
| `startOffset` | 2000px | –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ |
| `xOffset` | ¬±250px | –°–º–µ—â–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ |
| `rotation` | ¬±60deg | –ü–æ–≤–æ—Ä–æ—Ç –∫ —Ü–µ–Ω—Ç—Ä—É –∫–æ—Ä–∏–¥–æ—Ä–∞ |

---

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ/–ø–æ–∑–¥–Ω–æ, –∏–∑–º–µ–Ω–∏ –≤ `camera.js`:

```js
Camera.activeThreshold = 300; // –±–ª–∏–∂–µ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ
// –∏–ª–∏
Camera.activeThreshold = 500; // –¥–∞–ª—å—à–µ –æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
```

---

## üìù Commits

- [`1817442`](https://github.com/andreacebotarev-svg/englishlessons/commit/1817442df6dee05570cf18277c90d41c9d2cc82f) - üîß Fix card positioning: prevent animation override + center alignment
- [`83784a4`](https://github.com/andreacebotarev-svg/englishlessons/commit/83784a4f34a06ddeb3742aee7f4eef5ec68b0b2a) - ‚ú® Add active room detection to prevent camera clipping
