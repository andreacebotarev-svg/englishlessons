/* ============================================
   3D SCENE & WORLD
   –û–ø–∏—Å–∞–Ω–∏–µ: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä 3D —Å—Ü–µ–Ω—ã, –∫–∞–º–µ—Ä–∞, —Ç—É–º–∞–Ω
   Last update: 2025-12-11 (Perspective formula sync)
   ============================================ */

/* Viewport wrapper */
.viewport {
    height: calc(var(--viewport-height) * 1px);
    position: relative;
}

/* === SCENE CONTAINER === */
#scene, .scene-3d {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    
    /* ‚úÖ CRITICAL: –ò—Å–ø–æ–ª—å–∑—É–µ–º CSS variable —Å –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª–æ–π */
    perspective: var(--fov);  /* 200px (was 2400px) */
    perspective-origin: calc(var(--perspective-origin-x) * 1%) 
                       calc(var(--perspective-origin-y) * 1%);  /* 50% 30% */
    
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
    background: radial-gradient(ellipse at center, var(--bg-dark) 0%, var(--bg-black) 100%);
    
    /* üëâ transform-style –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –Ω–∞ #world —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å fixed positioning */
}

/* === WORLD CONTAINER === */
#world, #corridor {
    position: absolute;  /* ‚úÖ CRITICAL: was relative, now absolute for proper Z-depth */
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;  /* ‚úÖ CRITICAL: fixed height */
    transform-style: preserve-3d;
    
    /* ‚úÖ CRITICAL: –ö–∞–º–µ—Ä–∞ –¥–≤–∏–∂–µ—Ç—Å—è —á–µ—Ä–µ–∑ translateZ */
    transform: translate3d(0, 0, 0) translateZ(calc(var(--camera-z) * 1px));
    
    /* GPU acceleration */
    will-change: transform;
    backface-visibility: hidden;
    -webkit-font-smoothing: subpixel-antialiased;
}

/* === 3D WORLD TRANSFORM === */
#world {
    /* 3D effects preserved here instead of on scene container */
    transform-style: preserve-3d;
}

/* === FOG EFFECT === */
#scene::after, .scene-3d::after {
    content: '';
    position: fixed;
    top: 0; 
    left: 0; 
    right: 0; 
    bottom: 0;
    background: 
        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
        radial-gradient(ellipse 50% 40% at center 50%, 
            transparent 0%,
            rgba(0, 0, 0, 0.3) 40%,
            rgba(0, 0, 0, 0.6) 70%,
            rgba(0, 0, 0, 0.9) 90%,
            #000 100%
        ),
        /* –í–µ—Ä—Ö–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
        linear-gradient(180deg, 
            rgba(0, 0, 0, 0.8) 0%, 
            transparent 30%,
            transparent 70%,
            rgba(0, 0, 0, 0.8) 100%
        ),
        /* –ë–æ–∫–æ–≤–æ–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
        linear-gradient(90deg,
            rgba(0, 0, 0, 0.7) 0%,
            transparent 20%,
            transparent 80%,
            rgba(0, 0, 0, 0.7) 100%
        );
    pointer-events: none;
    z-index: var(--z-fog);
    animation: fogPulse 10s ease-in-out infinite;
}

@keyframes fogPulse {
    0%, 100% { opacity: 0.9; }
    50% { opacity: 1; }
}