<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìö –í—ã–±–æ—Ä —É—Ä–æ–∫–∞ - English Phonics Trainer</title>
  <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –¥–µ—Ç–µ–π —á—Ç–µ–Ω–∏—é">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/components.css">
</head>
<body>
  <div id="app">
    <div class="loading">
      <h1>üìö</h1>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤...</p>
      <div class="spinner"></div>
    </div>
  </div>

  <script type="module">
    import { lessonsManager } from './js/lessons.js';
    import { Storage } from './js/storage.js';
    import { createElement } from './js/utils.js';

    async function renderLessonSelect() {
      const app = document.getElementById('app');
      const data = Storage.get();
      
      app.innerHTML = `
        <div class="container">
          <div class="page-header">
            <h1>üìö English Phonics Trainer</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</p>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üéØ</div>
              <div class="stat-content">
                <div class="stat-value">${data.totalScore}</div>
                <div class="stat-label">–û—á–∫–æ–≤</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-content">
                <div class="stat-value">${data.totalWords}</div>
                <div class="stat-label">–°–ª–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">üìö</div>
              <div class="stat-content">
                <div class="stat-value">${data.totalLessons}</div>
                <div class="stat-label">–£—Ä–æ–∫–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">‚è±Ô∏è</div>
              <div class="stat-content">
                <div class="stat-value">${Math.floor(data.totalPlaytime / 60)}</div>
                <div class="stat-label">–ú–∏–Ω—É—Ç –∏–≥—Ä—ã</div>
              </div>
            </div>
          </div>
          
          <div id="lessons-grid" class="cards-grid">
            <div class="loading">
              <div class="spinner"></div>
              <p>–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤...</p>
            </div>
          </div>
        </div>
      `;
      
      // Load and render lessons
      try {
        const lessons = await lessonsManager.getAllLessons();
        renderLessons(lessons);
      } catch (error) {
        console.error('Failed to load lessons:', error);
        document.getElementById('lessons-grid').innerHTML = `
          <div style="text-align: center; padding: 2rem; background: rgba(239, 68, 68, 0.1); border-radius: 16px; border: 1px solid rgba(239, 68, 68, 0.3);">
            <h3>üö® –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã JSON –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ ../data/</p>
            <p style="font-size: 0.875rem; opacity: 0.8; margin-top: 1rem;">${error.message}</p>
          </div>
        `;
      }
    }

    function renderLessons(lessons) {
      const grid = document.getElementById('lessons-grid');
      grid.innerHTML = '';
      
      lessons.forEach(lesson => {
        const lessonData = Storage.getLessonData(lesson.id);
        const stars = lessonData?.stars || 0;
        const completedWords = lessonData?.completedWords || 0;
        const totalWords = lesson.words.length;
        
        let badgeText = '–ù–æ–≤—ã–π';
        let badgeClass = 'badge';
        
        if (completedWords === totalWords && stars > 0) {
          badgeText = '‚≠ê'.repeat(stars);
          badgeClass = 'badge badge-success';
        } else if (completedWords > 0) {
          badgeText = `${completedWords}/${totalWords}`;
          badgeClass = 'badge badge-warning';
        }
        
        const card = createElement('div', { className: 'card' }, [
          createElement('div', { className: 'card-icon', textContent: lesson.emoji || 'üìù' }),
          createElement('h3', { className: 'card-title', textContent: lesson.title }),
          createElement('p', { className: 'card-description', textContent: lesson.description }),
          createElement('span', { className: badgeClass, textContent: badgeText }),
          createElement('div', { className: 'card-footer', textContent: `üí¨ ${totalWords} —Å–ª–æ–≤ ‚Ä¢ ‚è±Ô∏è 10 –º–∏–Ω` })
        ]);
        
        card.addEventListener('click', () => {
          window.location.href = `index.html#/lesson/${lesson.id}`;
        });
        
        grid.appendChild(card);
      });
    }

    // Start app
    renderLessonSelect();
  </script>
</body>
</html>
