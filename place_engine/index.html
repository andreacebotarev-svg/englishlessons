// ========== –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö ==========
function getJsonPath(lessonId) {
  // –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π URL –ø—Ä–æ–µ–∫—Ç–∞
  const currentPath = window.location.pathname;
  const origin = window.location.origin;
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≥–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è
  console.log('üîç Current URL:', window.location.href);
  console.log('üìÇ Current Path:', currentPath);
  console.log('üåê Origin:', origin);
  
  // –°—Ç—Ä–æ–∏–º –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è —Å–∞–π—Ç–∞
  let basePath;
  if (currentPath.includes('/place_engine/')) {
    // –ú—ã –≤–Ω—É—Ç—Ä–∏ –¥–≤–∏–∂–∫–∞ - –∏–¥—ë–º –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤–≤–µ—Ä—Ö –∫ –∫–æ—Ä–Ω—é
    basePath = origin + '/data/' + lessonId + '.json';
  } else {
    // –ú—ã –≤ –∫–æ—Ä–Ω–µ
    basePath = origin + '/data/' + lessonId + '.json';
  }
  
  console.log('‚úÖ Constructed JSON path:', basePath);
  return basePath;
}

// ========== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò ==========
async function loadLessonData() {
  // –ü–æ–ª—É—á–∞–µ–º ID —É—Ä–æ–∫–∞ –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  const urlParams = new URLSearchParams(window.location.search);
  const lessonId = urlParams.get('lesson');
  
  if (!lessonId) {
    console.error('‚ùå No lesson ID in URL!');
    alert('–û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID —É—Ä–æ–∫–∞ –≤ URL');
    return null;
  }
  
  const jsonPath = getJsonPath(lessonId);
  
  // –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  console.log(`‚è≥ Attempting to fetch: ${jsonPath}`);
  
  try {
    const response = await fetch(jsonPath);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('‚úÖ JSON loaded successfully:', data);
    return data;
    
  } catch (error) {
    console.error('‚ùå Fetch failed:', error);
    alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:\n${jsonPath}\n\n–û—à–∏–±–∫–∞: ${error.message}`);
    return null;
  }
}

// –í—ã–∑–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', async () => {
  const lessonData = await loadLessonData();
  if (lessonData) {
    // –ó–¥–µ—Å—å —Ç–≤–æ—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    console.log('üìö Lesson data ready to use');
  }
});
